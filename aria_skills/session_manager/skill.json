{
  "name": "aria-session-manager",
  "version": "2.0.0",
  "description": "Session management via aria-api REST layer. All data in PostgreSQL (aria_engine.chat_sessions). List, prune stale, delete, stats.",
  "author": "Aria Team",
  "layer": 2,
  "dependencies": [],
  "focus_affinity": ["orchestrator"],
  "tools": [
    {
      "name": "list_sessions",
      "description": "List all sessions from the database. Returns id, agent_id, session_type, status, title, model, message_count, updated_at.",
      "parameters": {
        "type": "object",
        "properties": {
          "agent": {
            "type": "string",
            "description": "Filter by agent name (main, analyst, aria-talk, aria-memeothy). Empty = all agents.",
            "default": ""
          }
        }
      }
    },
    {
      "name": "delete_session",
      "description": "Delete a session and all its messages from the database.",
      "parameters": {
        "type": "object",
        "properties": {
          "session_id": {
            "type": "string",
            "description": "The session UUID to delete"
          },
          "agent": {
            "type": "string",
            "description": "Agent name (default: searches all agents)",
            "default": ""
          }
        },
        "required": ["session_id"]
      }
    },
    {
      "name": "prune_sessions",
      "description": "Archive stale sessions older than a threshold. Sessions are moved to archive tables (hidden from chat but Aria can still access them). Use dry_run=true to preview.",
      "parameters": {
        "type": "object",
        "properties": {
          "max_age_minutes": {
            "type": "integer",
            "description": "Delete sessions older than this many minutes (default: 60)",
            "default": 60
          },
          "dry_run": {
            "type": "boolean",
            "description": "If true, list what would be deleted without actually deleting",
            "default": false
          }
        }
      }
    },
    {
      "name": "get_session_stats",
      "description": "Get summary statistics: total sessions, stale count, active count, breakdown by agent.",
      "parameters": {
        "type": "object",
        "properties": {}
      }
    },
    {
      "name": "cleanup_after_delegation",
      "description": "Clean up a session after a sub-agent delegation completes. Calls delete_session internally.",
      "parameters": {
        "type": "object",
        "properties": {
          "session_id": {
            "type": "string",
            "description": "The session ID of the completed delegation to clean up"
          }
        },
        "required": ["session_id"]
      }
    },
    {
      "name": "list_archived_sessions",
      "description": "Browse archived sessions. These were pruned from chat but preserved for historical context. Aria can see past conversations here.",
      "parameters": {
        "type": "object",
        "properties": {
          "agent": {
            "type": "string",
            "description": "Filter by agent_id (default: all agents)",
            "default": ""
          },
          "limit": {
            "type": "integer",
            "description": "Max sessions to return (default 50, max 200)",
            "default": 50
          }
        }
      }
    },
    {
      "name": "cleanup_orphans",
      "description": "Clean up ghost sessions (0 messages, stale >15min) from the database. Run this periodically.",
      "parameters": {
        "type": "object",
        "properties": {
          "dry_run": {
            "type": "boolean",
            "description": "If true, report what would be cleaned without doing it",
            "default": false
          }
        }
      }
    }
  ],
  "run": "python3 /app/skills/run_skill.py session_manager {{tool}} '{{args_json}}'"
}
