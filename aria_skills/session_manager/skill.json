{
  "name": "aria-session-manager",
  "version": "2.0.0",
  "description": "Two-layer session management: delete from clawdbot filesystem (live) + mark ended in aria-api PG (history). Reads sessions.json directly, archives .jsonl transcripts.",
  "author": "Aria Team",
  "layer": 2,
  "dependencies": [],
  "focus_affinity": ["orchestrator"],
  "tools": [
    {
      "name": "list_sessions",
      "description": "List all active sessions from the filesystem (sessions.json) across all agents. Returns sessionId, agentId, session_type, label, updatedAt, model, contextTokens.",
      "parameters": {
        "type": "object",
        "properties": {
          "agent": {
            "type": "string",
            "description": "Filter by agent name (main, analyst, aria-talk, aria-memeothy). Empty = all agents.",
            "default": ""
          }
        }
      }
    },
    {
      "name": "delete_session",
      "description": "Delete a session: removes keys from sessions.json, archives .jsonl transcript, and PATCHes aria-api to mark status=ended (preserves history on /sessions dashboard).",
      "parameters": {
        "type": "object",
        "properties": {
          "session_id": {
            "type": "string",
            "description": "The OpenClaw session UUID to delete"
          },
          "agent": {
            "type": "string",
            "description": "Agent name (default: searches all agents)",
            "default": ""
          }
        },
        "required": ["session_id"]
      }
    },
    {
      "name": "prune_sessions",
      "description": "Prune stale sessions older than a threshold. Two-layer: filesystem delete + PG mark ended. Use dry_run=true to preview.",
      "parameters": {
        "type": "object",
        "properties": {
          "max_age_minutes": {
            "type": "integer",
            "description": "Delete sessions older than this many minutes (default: 60)",
            "default": 60
          },
          "dry_run": {
            "type": "boolean",
            "description": "If true, list what would be deleted without actually deleting",
            "default": false
          }
        }
      }
    },
    {
      "name": "get_session_stats",
      "description": "Get summary statistics: total sessions, stale count, active count, breakdown by agent.",
      "parameters": {
        "type": "object",
        "properties": {}
      }
    },
    {
      "name": "cleanup_after_delegation",
      "description": "Clean up a session after a sub-agent delegation completes. Calls delete_session internally.",
      "parameters": {
        "type": "object",
        "properties": {
          "session_id": {
            "type": "string",
            "description": "The session ID of the completed delegation to clean up"
          }
        },
        "required": ["session_id"]
      }
    },
    {
      "name": "cleanup_orphans",
      "description": "Clean up filesystem inconsistencies left by clawdbot's own session management: stale keys in index, orphan .jsonl transcripts not in index, and old .deleted files (>7 days). Run this periodically or after noticing session bloat.",
      "parameters": {
        "type": "object",
        "properties": {
          "dry_run": {
            "type": "boolean",
            "description": "If true, report what would be cleaned without doing it",
            "default": false
          }
        }
      }
    }
  ],
  "run": "python3 /root/.openclaw/workspace/skills/run_skill.py session_manager {{tool}} '{{args_json}}'"
}
