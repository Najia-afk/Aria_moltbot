# Traefik Dynamic Configuration - HTTP & HTTPS routes
tls:
  stores:
    default:
      defaultCertificate:
        certFile: /certs/cert.pem
        keyFile: /certs/key.pem
  certificates:
    - certFile: /certs/cert.pem
      keyFile: /certs/key.pem

http:
  routers:
    # HTTP Routers (fast LAN access)
    portal-http:
      rule: "PathPrefix(`/`)"
      priority: 1
      entryPoints:
        - web
      service: portal

    api-http:
      rule: "PathPrefix(`/api`)"
      priority: 100
      entryPoints:
        - web
      service: aria-api
      middlewares:
        - api-strip

    clawdbot-http:
      rule: "PathPrefix(`/clawdbot`)"
      priority: 90
      entryPoints:
        - web
      service: clawdbot
      middlewares:
        - clawdbot-strip

    grafana-http:
      rule: "PathPrefix(`/grafana`)"
      priority: 80
      entryPoints:
        - web
      service: grafana

    prometheus-http:
      rule: "PathPrefix(`/prometheus`)"
      priority: 80
      entryPoints:
        - web
      service: prometheus

    pgadmin-http:
      rule: "PathPrefix(`/pgadmin`)"
      priority: 80
      entryPoints:
        - web
      service: pgadmin

    ollama-http:
      rule: "PathPrefix(`/ollama`)"
      priority: 80
      entryPoints:
        - web
      service: ollama
      middlewares:
        - ollama-strip

    litellm-http:
      rule: "PathPrefix(`/litellm`)"
      priority: 80
      entryPoints:
        - web
      service: litellm
      middlewares:
        - litellm-strip

    traefik-dashboard-http:
      rule: "PathPrefix(`/traefik`)"
      priority: 70
      entryPoints:
        - web
      service: api@internal
      middlewares:
        - traefik-strip

    # HTTPS Routers (secure access)
    portal:
      rule: "PathPrefix(`/`)"
      priority: 1
      entryPoints:
        - websecure
      service: portal
      tls: {}

    api:
      rule: "PathPrefix(`/api`)"
      priority: 100
      entryPoints:
        - websecure
      service: aria-api
      middlewares:
        - api-strip
      tls: {}

    clawdbot:
      rule: "PathPrefix(`/clawdbot`)"
      priority: 90
      entryPoints:
        - websecure
      service: clawdbot
      middlewares:
        - clawdbot-strip
      tls: {}

    grafana:
      rule: "PathPrefix(`/grafana`)"
      priority: 80
      entryPoints:
        - websecure
      service: grafana
      tls: {}

    prometheus:
      rule: "PathPrefix(`/prometheus`)"
      priority: 80
      entryPoints:
        - websecure
      service: prometheus
      tls: {}

    pgadmin:
      rule: "PathPrefix(`/pgadmin`)"
      priority: 80
      entryPoints:
        - websecure
      service: pgadmin
      tls: {}

    ollama:
      rule: "PathPrefix(`/ollama`)"
      priority: 80
      entryPoints:
        - websecure
      service: ollama
      middlewares:
        - ollama-strip
      tls: {}

    litellm:
      rule: "PathPrefix(`/litellm`)"
      priority: 80
      entryPoints:
        - websecure
      service: litellm
      middlewares:
        - litellm-strip
      tls: {}

    traefik-dashboard:
      rule: "PathPrefix(`/traefik`)"
      priority: 70
      entryPoints:
        - websecure
      service: api@internal
      middlewares:
        - traefik-strip
      tls: {}

  middlewares:
    api-strip:
      stripPrefix:
        prefixes:
          - /api
    clawdbot-strip:
      stripPrefix:
        prefixes:
          - /clawdbot
    grafana-strip:
      stripPrefix:
        prefixes:
          - /grafana
    prometheus-strip:
      stripPrefix:
        prefixes:
          - /prometheus
    pgadmin-strip:
      stripPrefix:
        prefixes:
          - /pgadmin
    ollama-strip:
      stripPrefix:
        prefixes:
          - /ollama
    litellm-strip:
      stripPrefix:
        prefixes:
          - /litellm
    traefik-strip:
      stripPrefix:
        prefixes:
          - /traefik

  services:
    portal:
      loadBalancer:
        servers:
          - url: "http://aria-web:5000"
    aria-api:
      loadBalancer:
        servers:
          - url: "http://aria-api:8000"
    clawdbot:
      loadBalancer:
        servers:
          - url: "http://clawdbot:18789"
    grafana:
      loadBalancer:
        servers:
          - url: "http://grafana:3000"
    prometheus:
      loadBalancer:
        servers:
          - url: "http://prometheus:9090"
    pgadmin:
      loadBalancer:
        servers:
          - url: "http://aria-pgadmin:80"
    ollama:
      loadBalancer:
        servers:
          - url: "http://host.docker.internal:11434"
    litellm:
      loadBalancer:
        servers:
          - url: "http://litellm:4000"
