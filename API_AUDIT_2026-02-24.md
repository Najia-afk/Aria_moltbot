# Aria Moltbot — Complete API & Endpoint Audit

> Generated: 2026-02-24
> Scope: `src/api/` (FastAPI), `src/web/` (Flask), `aria_engine/entrypoint.py` (aiohttp)

---

## 1. Complete Endpoint Inventory (Code-Verified)

Every endpoint extracted from actual Python source code via `@router.*` decorators.

### 1.1 Health — `src/api/routers/health.py`

| # | Method | Path | Handler |
|---|--------|------|---------|
| 1 | GET | `/health` | `health_check` |
| 2 | GET | `/host-stats` | `host_stats` |
| 3 | GET | `/status` | `api_status` |
| 4 | GET | `/status/{service_id}` | `api_status_service` |
| 5 | GET | `/stats` | `api_stats` |
| 6 | GET | `/health/db` | `database_health` |

### 1.2 main.py Direct Routes

| # | Method | Path | Handler |
|---|--------|------|---------|
| 7 | GET | `/api/metrics` | Prometheus `metrics()` |

### 1.3 Activities — `src/api/routers/activities.py`

| # | Method | Path | Handler |
|---|--------|------|---------|
| 8 | GET | `/activities` | `api_activities` |
| 9 | POST | `/activities` | `create_activity` |
| 10 | GET | `/activities/cron-summary` | `cron_activity_summary` |
| 11 | GET | `/activities/timeline` | `activity_timeline` |
| 12 | GET | `/activities/visualization` | `activity_visualization` |

### 1.4 Thoughts — `src/api/routers/thoughts.py`

| # | Method | Path | Handler |
|---|--------|------|---------|
| 13 | GET | `/thoughts` | `api_thoughts` |
| 14 | POST | `/thoughts` | `create_thought` |

### 1.5 Memories — `src/api/routers/memories.py`

| # | Method | Path | Handler |
|---|--------|------|---------|
| 15 | GET | `/memories` | `get_memories` |
| 16 | POST | `/memories` | `create_or_update_memory` |
| 17 | GET | `/memories/semantic` | `list_semantic_memories` |
| 18 | POST | `/memories/semantic` | `store_semantic_memory` |
| 19 | GET | `/memories/search` | `search_memories` |
| 20 | POST | `/memories/search-by-vector` | `search_memories_by_vector` |
| 21 | POST | `/memories/summarize-session` | `summarize_session` |
| 22 | GET | `/memories/{key}` | `get_memory_by_key` |
| 23 | DELETE | `/memories/{key}` | `delete_memory` |

### 1.6 Goals — `src/api/routers/goals.py`

| # | Method | Path | Handler |
|---|--------|------|---------|
| 24 | GET | `/goals` | `list_goals` |
| 25 | POST | `/goals` | `create_goal` |
| 26 | GET | `/goals/board` | `goal_board` |
| 27 | GET | `/goals/archive` | `goal_archive` |
| 28 | GET | `/goals/sprint-summary` | `goal_sprint_summary` |
| 29 | GET | `/goals/history` | `goal_history` |
| 30 | GET | `/goals/{goal_id}` | `get_goal` |
| 31 | DELETE | `/goals/{goal_id}` | `delete_goal` |
| 32 | PATCH | `/goals/{goal_id}` | `update_goal` |
| 33 | PATCH | `/goals/{goal_id}/move` | `move_goal` |
| 34 | GET | `/hourly-goals` | `get_hourly_goals` |
| 35 | POST | `/hourly-goals` | `create_hourly_goal` |
| 36 | PATCH | `/hourly-goals/{goal_id}` | `update_hourly_goal` |

### 1.7 Sessions — `src/api/routers/sessions.py`

| # | Method | Path | Handler |
|---|--------|------|---------|
| 37 | GET | `/sessions` | `get_agent_sessions` |
| 38 | GET | `/sessions/hourly` | `get_sessions_hourly` |
| 39 | POST | `/sessions` | `create_agent_session` |
| 40 | PATCH | `/sessions/{session_id}` | `update_agent_session` |
| 41 | DELETE | `/sessions/{session_id}` | `delete_agent_session` |
| 42 | GET | `/sessions/stats` | `get_session_stats` |

### 1.8 Model Usage — `src/api/routers/model_usage.py`

| # | Method | Path | Handler |
|---|--------|------|---------|
| 43 | GET | `/model-usage` | `get_model_usage` |
| 44 | POST | `/model-usage` | `log_model_usage` |
| 45 | GET | `/model-usage/stats` | `get_model_usage_stats` |

### 1.9 LiteLLM — `src/api/routers/litellm.py`

| # | Method | Path | Handler |
|---|--------|------|---------|
| 46 | GET | `/litellm/models` | `api_litellm_models` |
| 47 | GET | `/litellm/health` | `api_litellm_health` |
| 48 | GET | `/litellm/spend` | `api_litellm_spend` |
| 49 | GET | `/litellm/global-spend` | `api_litellm_global_spend` |

### 1.10 Providers — `src/api/routers/providers.py`

| # | Method | Path | Handler |
|---|--------|------|---------|
| 50 | GET | `/providers/balances` | `api_provider_balances` |

### 1.11 Security — `src/api/routers/security.py`

| # | Method | Path | Handler |
|---|--------|------|---------|
| 51 | GET | `/security-events` | `api_security_events` |
| 52 | POST | `/security-events` | `create_security_event` |
| 53 | GET | `/security-events/stats` | `api_security_stats` |

### 1.12 Knowledge Graph — `src/api/routers/knowledge.py`

| # | Method | Path | Handler |
|---|--------|------|---------|
| 54 | GET | `/skill-graph` | `get_skill_graph` |
| 55 | POST | `/knowledge-graph/sync-skills` | `sync_skills` |
| 56 | GET | `/knowledge-graph` | `get_knowledge_graph` |
| 57 | GET | `/knowledge-graph/entities` | `get_knowledge_entities` |
| 58 | GET | `/knowledge-graph/relations` | `get_knowledge_relations` |
| 59 | POST | `/knowledge-graph/entities` | `create_knowledge_entity` |
| 60 | POST | `/knowledge-graph/relations` | `create_knowledge_relation` |
| 61 | DELETE | `/knowledge-graph/auto-generated` | `delete_auto_generated` |
| 62 | GET | `/knowledge-graph/traverse` | `graph_traverse` |
| 63 | GET | `/knowledge-graph/search` | `graph_search` |
| 64 | GET | `/knowledge-graph/skill-for-task` | `find_skill_for_task` |
| 65 | GET | `/knowledge-graph/query-log` | `get_query_log` |
| 66 | GET | `/knowledge-graph/kg-traverse` | `kg_traverse` ⚠️ NOT IN INVENTORY |
| 67 | GET | `/knowledge-graph/kg-search` | `kg_search` ⚠️ NOT IN INVENTORY |

### 1.13 Social — `src/api/routers/social.py`

| # | Method | Path | Handler |
|---|--------|------|---------|
| 68 | GET | `/social` | `get_social_posts` |
| 69 | POST | `/social` | `create_social_post` |
| 70 | POST | `/social/cleanup` | `cleanup_social_posts` |
| 71 | POST | `/social/dedupe` | `dedupe_social_posts` |
| 72 | POST | `/social/import-moltbook` | `import_moltbook` |

### 1.14 Operations — `src/api/routers/operations.py`

| # | Method | Path | Handler |
|---|--------|------|---------|
| 73 | GET | `/rate-limits` | `get_rate_limits` |
| 74 | POST | `/rate-limits/check` | `check_rate_limit` |
| 75 | POST | `/rate-limits/increment` | `increment_rate_limit` |
| 76 | GET | `/api-key-rotations` | `get_api_key_rotations` |
| 77 | POST | `/api-key-rotations` | `log_api_key_rotation` |
| 78 | GET | `/heartbeat` | `get_heartbeats` |
| 79 | POST | `/heartbeat` | `create_heartbeat` |
| 80 | GET | `/heartbeat/latest` | `get_latest_heartbeat` |
| 81 | GET | `/performance` | `get_performance_logs` |
| 82 | POST | `/performance` | `create_performance_log` |
| 83 | GET | `/tasks` | `get_pending_tasks` |
| 84 | POST | `/tasks` | `create_pending_task` |
| 85 | PATCH | `/tasks/{task_id}` | `update_pending_task` |
| 86 | GET | `/schedule` | `get_schedule` |
| 87 | POST | `/schedule/tick` | `manual_tick` |
| 88 | GET | `/jobs` | `get_scheduled_jobs` |
| 89 | GET | `/jobs/live` | `get_jobs_live` |
| 90 | GET | `/jobs/{job_id}` | `get_scheduled_job` |
| 91 | POST | `/jobs/sync` | `sync_jobs` |

### 1.15 Records — `src/api/routers/records.py`

| # | Method | Path | Handler |
|---|--------|------|---------|
| 92 | GET | `/records` | `api_records` |
| 93 | GET | `/export` | `api_export` |
| 94 | GET | `/search` | `api_search` |

### 1.16 Admin — `src/api/routers/admin.py`

| # | Method | Path | Handler |
|---|--------|------|---------|
| 95 | POST | `/admin/services/{service_id}/{action}` | `api_service_control` |
| 96 | GET | `/soul/{filename}` | `read_soul_file` |
| 97 | GET | `/admin/files/mind` | `list_mind_files` |
| 98 | GET | `/admin/files/memories` | `list_memories_files` |
| 99 | GET | `/admin/files/agents` | `list_agents_files` |
| 100 | GET | `/admin/files/souvenirs` | `list_souvenirs_files` |
| 101 | GET | `/admin/files/mind/{path:path}` | `read_mind_file` |
| 102 | GET | `/admin/files/memories/{path:path}` | `read_memories_file` |
| 103 | GET | `/admin/files/agents/{path:path}` | `read_agents_file` |
| 104 | GET | `/admin/files/souvenirs/{path:path}` | `read_souvenirs_file` |
| 105 | POST | `/maintenance` | `run_maintenance` |
| 106 | GET | `/table-stats` | `table_stats` |

### 1.17 Models Config — `src/api/routers/models_config.py`

| # | Method | Path | Handler |
|---|--------|------|---------|
| 107 | GET | `/models/config` | `api_models_config` |
| 108 | GET | `/models/available` | `api_models_available` |
| 109 | GET | `/models/pricing` | `api_models_pricing` |
| 110 | POST | `/models/reload` | `api_models_reload` |

### 1.18 Models CRUD — `src/api/routers/models_crud.py`

| # | Method | Path | Handler |
|---|--------|------|---------|
| 111 | GET | `/models/db` | `list_models_db` |
| 112 | GET | `/models/db/{model_id}` | `get_model_db` |
| 113 | POST | `/models/db` | `create_model_db` |
| 114 | PUT | `/models/db/{model_id}` | `update_model_db` |
| 115 | DELETE | `/models/db/{model_id}` | `delete_model_db` |
| 116 | POST | `/models/db/sync` | `sync_models_db` |

### 1.19 Working Memory — `src/api/routers/working_memory.py`

| # | Method | Path | Handler |
|---|--------|------|---------|
| 117 | GET | `/working-memory` | `list_working_memory` |
| 118 | GET | `/working-memory/context` | `get_working_memory_context` |
| 119 | POST | `/working-memory` | `store_working_memory` |
| 120 | PATCH | `/working-memory/{item_id}` | `update_working_memory` |
| 121 | DELETE | `/working-memory/{item_id}` | `delete_working_memory` |
| 122 | POST | `/working-memory/checkpoint` | `create_checkpoint` |
| 123 | GET | `/working-memory/checkpoint` | `get_latest_checkpoint` |
| 124 | GET | `/working-memory/stats` | `get_working_memory_stats` |
| 125 | GET | `/working-memory/file-snapshot` | `get_working_memory_file_snapshot` |
| 126 | POST | `/working-memory/cleanup` | `cleanup_working_memory` |

### 1.20 Skills — `src/api/routers/skills.py`

| # | Method | Path | Handler |
|---|--------|------|---------|
| 127 | GET | `/skills` | `list_skills` |
| 128 | GET | `/skills/{name}/health` | `get_skill_health` |
| 129 | POST | `/skills/seed` | `seed_skills` |
| 130 | GET | `/skills/coherence` | `get_skills_coherence` |
| 131 | POST | `/skills/invocations` | `record_invocation` |
| 132 | DELETE | `/skills/invocations/purge-test-data` | `purge_test_invocations` ⚠️ NOT IN INVENTORY |
| 133 | GET | `/skills/stats` | `skill_stats` |
| 134 | GET | `/skills/stats/summary` | `skill_stats_summary` |
| 135 | GET | `/skills/stats/{skill_name}` | `skill_detail_stats` |
| 136 | GET | `/skills/insights` | `skills_insights` |
| 137 | GET | `/skills/health/dashboard` | `skill_health_dashboard` |

### 1.21 Lessons — `src/api/routers/lessons.py`

| # | Method | Path | Handler |
|---|--------|------|---------|
| 138 | POST | `/lessons` | `record_lesson` |
| 139 | GET | `/lessons/check` | `check_known_errors` |
| 140 | GET | `/lessons` | `list_lessons` |
| 141 | POST | `/lessons/seed` | `seed_lessons` |

### 1.22 Proposals — `src/api/routers/proposals.py`

| # | Method | Path | Handler |
|---|--------|------|---------|
| 142 | POST | `/proposals` | `create_proposal` |
| 143 | GET | `/proposals` | `list_proposals` |
| 144 | GET | `/proposals/{proposal_id}` | `get_proposal` |
| 145 | PATCH | `/proposals/{proposal_id}` | `review_proposal` |

### 1.23 Analysis — `src/api/routers/analysis.py` (prefix: `/analysis`)

| # | Method | Path | Handler |
|---|--------|------|---------|
| 146 | POST | `/analysis/sentiment/message` | `analyze_message_sentiment` |
| 147 | POST | `/analysis/sentiment/backfill-sessions` | `backfill_sentiment_from_sessions` |
| 148 | POST | `/analysis/sentiment/conversation` | `analyze_conversation_sentiment` |
| 149 | POST | `/analysis/sentiment/reply` | `analyze_realtime_user_reply_sentiment` |
| 150 | POST | `/analysis/sentiment/backfill-messages` | `backfill_sentiment_from_session_messages` |
| 151 | GET | `/analysis/sentiment/history` | `get_sentiment_history` |
| 152 | GET | `/analysis/sentiment/score` | `get_sentiment_score` ⚠️ NOT IN INVENTORY |
| 153 | POST | `/analysis/sentiment/seed-references` | `seed_sentiment_references` |
| 154 | POST | `/analysis/sentiment/feedback` | `sentiment_feedback_loop` |
| 155 | POST | `/analysis/sentiment/auto-promote` | `auto_promote_high_confidence_events` |
| 156 | POST | `/analysis/sentiment/cleanup-placeholders` | `cleanup_sentiment_placeholders` |
| 157 | POST | `/analysis/patterns/detect` | `detect_patterns` |
| 158 | GET | `/analysis/patterns/history` | `get_pattern_history` |
| 159 | POST | `/analysis/compression/run` | `run_compression` |
| 160 | GET | `/analysis/compression/history` | `get_compression_history` |
| 161 | POST | `/analysis/compression/auto-run` | `run_auto_compression` |
| 162 | POST | `/analysis/seed-memories` | `seed_semantic_memories` |

### 1.24 Engine Cron — `src/api/routers/engine_cron.py` (prefix: `/engine/cron`)

| # | Method | Path | Handler |
|---|--------|------|---------|
| 163 | GET | `/engine/cron` | `list_cron_jobs` |
| 164 | POST | `/engine/cron` | `create_cron_job` |
| 165 | GET | `/engine/cron/status` | `get_scheduler_status` |
| 166 | GET | `/engine/cron/{job_id}` | `get_cron_job` |
| 167 | PUT | `/engine/cron/{job_id}` | `update_cron_job` |
| 168 | DELETE | `/engine/cron/{job_id}` | `delete_cron_job` |
| 169 | POST | `/engine/cron/{job_id}/trigger` | `trigger_cron_job` |
| 170 | GET | `/engine/cron/{job_id}/history` | `get_job_history` |

### 1.25 Engine Sessions — `src/api/routers/engine_sessions.py` (prefix: `/engine/sessions`)

| # | Method | Path | Handler |
|---|--------|------|---------|
| 171 | GET | `/engine/sessions` | `list_sessions` |
| 172 | GET | `/engine/sessions/stats` | `get_session_stats` |
| 173 | GET | `/engine/sessions/{session_id}` | `get_session` |
| 174 | GET | `/engine/sessions/{session_id}/messages` | `get_session_messages` |
| 175 | DELETE | `/engine/sessions/{session_id}` | `delete_session` |
| 176 | POST | `/engine/sessions/{session_id}/end` | `end_session` |
| 177 | PATCH | `/engine/sessions/{session_id}/title` | `update_session_title` ⚠️ NOT IN INVENTORY |
| 178 | POST | `/engine/sessions/{session_id}/archive` | `archive_session` ⚠️ NOT IN INVENTORY |
| 179 | DELETE | `/engine/sessions/ghosts` | `delete_ghost_sessions` ⚠️ NOT IN INVENTORY |
| 180 | POST | `/engine/sessions/cleanup` | `cleanup_sessions` ⚠️ NOT IN INVENTORY |

### 1.26 Engine Agents — `src/api/routers/engine_agents.py` (prefix: `/engine/agents`)

| # | Method | Path | Handler |
|---|--------|------|---------|
| 181 | GET | `/engine/agents` | `list_agents` |
| 182 | GET | `/engine/agents/{agent_id}` | `get_agent` |

### 1.27 Engine Agent Metrics — `src/api/routers/engine_agent_metrics.py` (prefix: `/engine/agents/metrics`)

| # | Method | Path | Handler |
|---|--------|------|---------|
| 183 | GET | `/engine/agents/metrics` | `get_all_metrics` |
| 184 | GET | `/engine/agents/metrics/{agent_id}` | `get_agent_metrics` |
| 185 | GET | `/engine/agents/metrics/{agent_id}/history` | `get_agent_score_history` |

### 1.28 Agents CRUD — `src/api/routers/agents_crud.py`

| # | Method | Path | Handler |
|---|--------|------|---------|
| 186 | GET | `/agents/db` | `list_agents_db` |
| 187 | GET | `/agents/db/{agent_id}` | `get_agent_db` |
| 188 | POST | `/agents/db` | `create_agent_db` |
| 189 | PUT | `/agents/db/{agent_id}` | `update_agent_db` |
| 190 | DELETE | `/agents/db/{agent_id}` | `delete_agent_db` |
| 191 | POST | `/agents/db/{agent_id}/enable` | `enable_agent` |
| 192 | POST | `/agents/db/{agent_id}/disable` | `disable_agent` |
| 193 | POST | `/agents/db/enable-core` | `enable_core_agents` ⚠️ NOT IN INVENTORY |
| 194 | POST | `/agents/db/enable-all` | `enable_all_agents` ⚠️ NOT IN INVENTORY |
| 195 | POST | `/agents/db/sync` | `sync_agents_from_md` |

### 1.29 Engine Chat — `src/api/routers/engine_chat.py` (prefix: `/engine/chat`)

| # | Method | Path | Handler |
|---|--------|------|---------|
| 196 | POST | `/engine/chat/sessions` | `create_session` |
| 197 | GET | `/engine/chat/sessions` | `list_sessions` |
| 198 | GET | `/engine/chat/sessions/{session_id}` | `get_session` |
| 199 | GET | `/engine/chat/sessions/{session_id}/messages` | `get_session_messages` |
| 200 | POST | `/engine/chat/sessions/{session_id}/messages` | `send_message` |
| 201 | DELETE | `/engine/chat/sessions/{session_id}` | `delete_session` |
| 202 | GET | `/engine/chat/sessions/{session_id}/export` | `export_session_endpoint` |

### 1.30 Engine Roundtable — `src/api/routers/engine_roundtable.py` (prefix: `/engine/roundtable`)

| # | Method | Path | Handler |
|---|--------|------|---------|
| 203 | POST | `/engine/roundtable` | `start_roundtable` |
| 204 | POST | `/engine/roundtable/async` | `start_roundtable_async` |
| 205 | GET | `/engine/roundtable` | `list_roundtables` |
| 206 | GET | `/engine/roundtable/agents/available` | `get_available_agents` |
| 207 | GET | `/engine/roundtable/status/{key}` | `get_roundtable_status` |
| 208 | GET | `/engine/roundtable/{session_id}` | `get_roundtable` |
| 209 | GET | `/engine/roundtable/{session_id}/turns` | `get_roundtable_turns` |
| 210 | DELETE | `/engine/roundtable/{session_id}` | `delete_roundtable` |
| 211 | POST | `/engine/roundtable/swarm` | `start_swarm` |
| 212 | POST | `/engine/roundtable/swarm/async` | `start_swarm_async` |
| 213 | GET | `/engine/roundtable/swarm/status/{key}` | `get_swarm_status` |
| 214 | GET | `/engine/roundtable/swarm/{session_id}` | `get_swarm` |

### 1.31 Artifacts — `src/api/routers/artifacts.py` ⚠️ ENTIRE ROUTER NOT IN INVENTORY

| # | Method | Path | Handler |
|---|--------|------|---------|
| 215 | POST | `/artifacts` | `write_artifact` |
| 216 | GET | `/artifacts/{category}/{filename:path}` | `read_artifact` |
| 217 | GET | `/artifacts` | `list_artifacts` |
| 218 | DELETE | `/artifacts/{category}/{filename:path}` | `delete_artifact` |

### 1.32 RPG Dashboard — `src/api/routers/rpg.py` ⚠️ ENTIRE ROUTER NOT IN INVENTORY

| # | Method | Path | Handler |
|---|--------|------|---------|
| 219 | GET | `/rpg/campaigns` | `list_campaigns` |
| 220 | GET | `/rpg/campaign/{campaign_id}` | `get_campaign_detail` |
| 221 | GET | `/rpg/session/{session_id}/transcript` | `get_session_transcript` |
| 222 | GET | `/rpg/campaign/{campaign_id}/kg` | `get_campaign_kg` |

### 1.33 WebSocket Endpoints

| # | Protocol | Path | Handler | Router File |
|---|----------|------|---------|-------------|
| 223 | WS | `/ws/chat/{session_id}` | `chat_websocket` | engine_chat.py |
| 224 | WS | `/ws/roundtable` | `roundtable_websocket` | engine_roundtable.py |

### 1.34 GraphQL

| # | Protocol | Path | Handler |
|---|----------|------|---------|
| 225 | POST/GET | `/graphql` | Strawberry GraphQL schema |

### 1.35 Standalone (non-FastAPI)

| # | Method | Path | Port | File |
|---|--------|------|------|------|
| 226 | GET | `/health` | 8081 | `aria_engine/entrypoint.py` |

---

## 2. Total Counts

| Category | Count |
|----------|-------|
| **REST endpoints (FastAPI)** | **222** |
| **WebSocket endpoints** | **2** |
| **GraphQL endpoint** | **1** |
| **Standalone (aiohttp)** | **1** |
| **Grand Total** | **226** |
| Router files | 30 |
| DB ORM models | 37+ (across `aria_data` + `aria_engine` schemas) |

---

## 3. Ghost Endpoints — Documented in API_ENDPOINT_INVENTORY.md but NOT in Code

| # | Method | Path | Documented In | Issue |
|---|--------|------|---------------|-------|
| 1 | DELETE | `/proposals/{proposal_id}` | Inventory #144 | **NOT in code** — `proposals.py` has only POST, GET, PATCH. No delete handler exists. |
| 2 | DELETE | `/hourly-goals/{goal_id}` | Inventory #37 | **NOT in code** — `goals.py` has GET, POST, PATCH for hourly-goals but no DELETE. |

> **2 ghost endpoints** — documented as existing but not implemented.

---

## 4. Missing Documentation — Endpoints in Code but NOT in API_ENDPOINT_INVENTORY.md

### 4.1 Entire Routers Missing from Inventory

| Router | Endpoints | Notes |
|--------|-----------|-------|
| **`artifacts.py`** | 4 endpoints (POST, GET, GET list, DELETE) | File artifact CRUD — completely undocumented |
| **`rpg.py`** | 4 endpoints (campaigns list/detail, transcript, KG) | RPG dashboard API — completely undocumented |
| **Engine Roundtable (REST)** | 12 endpoints | POST/GET/DELETE roundtable + swarm + async variants — all undocumented |

### 4.2 Individual Endpoints Missing

| # | Method | Path | Router File | Notes |
|---|--------|------|-------------|-------|
| 1 | GET | `/analysis/sentiment/score` | analysis.py | Overall sentiment score endpoint — not in inventory |
| 2 | GET | `/knowledge-graph/kg-traverse` | knowledge.py | Duplicate/alternate traverse endpoint — not in inventory |
| 3 | GET | `/knowledge-graph/kg-search` | knowledge.py | Duplicate/alternate search endpoint — not in inventory |
| 4 | DELETE | `/skills/invocations/purge-test-data` | skills.py | Test data cleanup endpoint — not in inventory |
| 5 | PATCH | `/engine/sessions/{id}/title` | engine_sessions.py | Title update endpoint — not in inventory |
| 6 | POST | `/engine/sessions/{id}/archive` | engine_sessions.py | Archive endpoint — not in inventory |
| 7 | DELETE | `/engine/sessions/ghosts` | engine_sessions.py | Ghost session purge — not in inventory |
| 8 | POST | `/engine/sessions/cleanup` | engine_sessions.py | Session cleanup — not in inventory |
| 9 | POST | `/agents/db/enable-core` | agents_crud.py | Enable core agents batch — not in inventory |
| 10 | POST | `/agents/db/enable-all` | agents_crud.py | Enable all agents batch — not in inventory |
| 11 | WS | `/ws/roundtable` | engine_roundtable.py | Roundtable WebSocket — not in inventory |

> **31 undocumented endpoints** total (20 from entire routers + 11 individual).

---

## 5. Architecture Analysis

### 5.1 Target Architecture (5-Layer)

```
DB ↔ SQLAlchemy ORM ↔ FastAPI Routers ↔ api_client skill ↔ Skills ↔ Agents
```

### 5.2 Architecture Compliance ✅

| Component | Direct DB Access? | Verdict |
|-----------|-------------------|---------|
| `aria_skills/` | **No** — uses `api_client` skill for all DB ops | ✅ Compliant |
| `aria_agents/` | **No** — no SQLAlchemy/psycopg imports found | ✅ Compliant |
| `aria_engine/` | **Yes** — but this is by design (engine IS the DB layer) | ✅ Expected |
| `src/api/routers/` | Uses ORM via `get_db()` dependency | ✅ Expected |
| `src/web/app.py` | **No** — Flask acts as pure UI, proxies `/api/*` to FastAPI | ✅ Compliant |

### 5.3 Architecture Violations ⚠️

| # | Severity | Location | Issue |
|---|----------|----------|-------|
| 1 | **LOW** | `engine_chat.py` `list_sessions()` | Imports `get_db` and queries `EngineChatSession` directly inside the handler instead of delegating to `ChatEngine`. Bypasses the engine abstraction. |
| 2 | **LOW** | `engine_roundtable.py` | Creates its own `async_sessionmaker` from `_db_engine` instead of using the standard `get_db()` dependency. Separate session management path. |
| 3 | **INFO** | `rpg.py` | Reads YAML files from `aria_memories/rpg/` directly + queries KG DB. Mixed filesystem + DB access in one router is fine but adds coupling. |

> Overall: **Architecture is well-enforced.** Skills and agents do NOT access DB directly. The 5-layer boundary is maintained.

---

## 6. Security Issues

### 6.1 Critical / High

| # | Severity | Issue | Location | Details |
|---|----------|-------|----------|---------|
| 1 | **HIGH** | No authentication on ANY endpoint | All routers | Zero endpoints require auth tokens, API keys, or session validation. Anyone with network access can read/write all data. |
| 2 | **HIGH** | `/admin/services/{service_id}/{action}` — No auth on service control | admin.py | Can start/stop Docker containers and run shell commands without authentication. |
| 3 | **HIGH** | `/maintenance` — Raw SQL ANALYZE without auth | admin.py | Runs `ANALYZE` on the database. No access control. |
| 4 | **HIGH** | `/artifacts` — File write to server filesystem without auth | artifacts.py | Can write arbitrary files to `aria_memories/` directory. Category whitelist helps, but no auth. |
| 5 | **HIGH** | `/admin/files/{scope}/{path}` — Filesystem read without auth | admin.py | Can read any file within `aria_mind/`, `aria_memories/`, with only path-traversal protection. |

### 6.2 Medium

| # | Severity | Issue | Location | Details |
|---|----------|-------|----------|---------|
| 6 | **MEDIUM** | CORS allows all origins in code default | main.py | `_CORS_ORIGINS` defaults to `localhost:5000,aria-web:5000` but `API.md` says `allow_origins=["*"]`. The env var `CORS_ALLOWED_ORIGINS` controls this — if unset, only internal origins are allowed. **Verify production env.** |
| 7 | **MEDIUM** | Rate limiting only on write methods | security_middleware.py | GET/HEAD/OPTIONS bypass rate limiting entirely. A DDoS on expensive read endpoints (e.g., `/knowledge-graph/traverse`, `/analysis/sentiment/history`) is unmitigated. |
| 8 | **MEDIUM** | In-memory rate limiter not shared across workers | security_middleware.py | `RateLimiter` uses a Python dict. If running multiple uvicorn workers, each has independent state, allowing N× the intended rate. |
| 9 | **MEDIUM** | Global exception handler exposes internal details | main.py | Returns `str(exc)[:200]` and `type(exc).__name__` in 500 responses. Could leak internal paths, DB schema names, or SQL errors. |
| 10 | **MEDIUM** | `/engine/chat/sessions/{id}/messages` (POST) — sends user text to LLM | engine_chat.py | Body scanning exempted via `EXEMPT_PREFIXES = "/engine/chat"`. Prompt injection via chat is by design but could be used to exfiltrate data via tool calls. |

### 6.3 Low / Informational

| # | Severity | Issue | Location | Details |
|---|----------|-------|----------|---------|
| 11 | **LOW** | SQL injection pattern in middleware too broad | security_middleware.py | Pattern `(--|;|/\\*|\\*/|@@)` blocks semicolons and comments. Legitimate text like `-- dashes` in content bodies triggers false positives. Mitigated by `EXEMPT_PREFIXES`. |
| 12 | **LOW** | `litellm_api_key` stored in LlmModelEntry model | db/models.py | API keys stored as `String(500)` in DB. No encryption at rest. The `to_dict()` method will serialize this field. |
| 13 | **LOW** | XSS pattern `on\w+=` causes false positives | security_middleware.py | Matches legitimate JSON like `{"online": true}`. Mitigated by exempt paths but reduces usability. |
| 14 | **INFO** | No CSRF protection | All POST endpoints | Not critical for an API (no cookie auth), but if sessions are ever added, CSRF tokens would be needed. |

---

## 7. Input Validation Assessment

| Router | Pydantic Validation | Query Param Validation | Path Param Validation |
|--------|--------------------|-----------------------|----------------------|
| health.py | N/A (read only) | ✅ | ✅ |
| activities.py | ⚠️ Uses `request.json()` raw | ✅ Pagination | ✅ |
| thoughts.py | ⚠️ Uses `request.json()` raw | ✅ | N/A |
| memories.py | ⚠️ Mixed (Pydantic for semantic, raw for basic) | ✅ | ✅ |
| goals.py | ⚠️ Uses `request.json()` raw | ✅ | ✅ UUID |
| sessions.py | ⚠️ Uses `request.json()` raw | ✅ | ✅ |
| model_usage.py | ⚠️ Uses `request.json()` raw | ✅ | N/A |
| security.py | ⚠️ Uses `request.json()` raw | ✅ | N/A |
| knowledge.py | ⚠️ Uses `request.json()` raw | ✅ | ✅ |
| social.py | ⚠️ Mixed | ✅ | N/A |
| operations.py | ⚠️ Uses `request.json()` raw | ✅ | ✅ |
| admin.py | ⚠️ Minimal validation | N/A | ✅ Path traversal check |
| models_crud.py | ✅ Full Pydantic models | ✅ | ✅ |
| working_memory.py | ✅ Pydantic for POST | ✅ | ✅ UUID |
| skills.py | ⚠️ Uses `request.json()` raw | ✅ | ✅ |
| lessons.py | ⚠️ Uses `request.json()` raw | ✅ | N/A |
| proposals.py | ⚠️ Uses `request.json()` raw | N/A | ✅ UUID |
| analysis.py | ✅ Pydantic models | ✅ | N/A |
| engine_chat.py | ✅ Full Pydantic models | ✅ `Query()` with constraints | ✅ UUID validation |
| engine_cron.py | ✅ Pydantic models | ✅ | ✅ |
| engine_sessions.py | ✅ Pydantic response models | ✅ | ✅ |
| engine_roundtable.py | ✅ Full Pydantic with Field constraints | ✅ | ✅ |
| agents_crud.py | ✅ Pydantic models | ✅ | ✅ |
| artifacts.py | ✅ Pydantic + category whitelist | ✅ | ✅ Path traversal check |
| rpg.py | ✅ Pydantic response models | ✅ | ✅ |

> **Issue:** ~15 routers use `request.json()` instead of Pydantic request bodies. This means:
> - No automatic type validation
> - No OpenAPI schema generation for request bodies
> - No auto-documentation in Swagger UI
> - Silent failures on missing fields

---

## 8. Performance Concerns

| # | Severity | Issue | Details |
|---|----------|-------|---------|
| 1 | **HIGH** | `/knowledge-graph/traverse` and `/rpg/campaign/{id}/kg` — BFS without result cap | BFS traversal up to `max_depth=5` with N+1 queries per hop. Deep KG could mean hundreds of sequential queries. |
| 2 | **HIGH** | `/engine/roundtable` (GET list) — loads ALL sessions from both working + archive tables | Fetches all roundtable/swarm sessions into memory, sorts in Python, then paginates. Won't scale past ~10K sessions. |
| 3 | **MEDIUM** | `/records` — Dynamic model selection via `MODEL_MAP` on 18 tables | Generic endpoint that can query any table. No query optimization per table — relies on indexes. |
| 4 | **MEDIUM** | `/activities/visualization` — Potentially large aggregation | Timeline visualization with no obvious time-window cap. |
| 5 | **MEDIUM** | `/analysis/sentiment/backfill-*` — Bulk processing endpoints | Iterate over session messages and call LLM for each. No batch size limit visible in endpoint signature. |
| 6 | **LOW** | Eager-loaded relationships | `SemanticMemory`, `AgentSession.usage_records`, `SocialPost.parent_post` use `lazy="selectin"` which adds extra queries per access. |
| 7 | **LOW** | In-memory caches in `engine_roundtable.py` | `_completed` and `_swarm_completed` dicts grow unbounded — completed results are never evicted. |

---

## 9. Summary Dashboard

| Metric | Value |
|--------|-------|
| Total endpoints in code | **226** |
| Documented in inventory | ~197 |
| Ghost endpoints (doc only) | **2** (`DELETE /proposals/{id}`, `DELETE /hourly-goals/{id}`) |
| Undocumented endpoints | **31** (3 entire routers + 11 individual) |
| Architecture violations | **0 critical** (2 low-severity style issues) |
| Security: No auth endpoints | **222/222** (100% — zero authentication) |
| Security: High severity | **5** |
| Security: Medium severity | **5** |
| Pydantic validation gaps | **~15 routers** use raw `request.json()` |
| Performance concerns | **2 high**, **3 medium** |

---

## 10. Recommendations (Priority Order)

1. **Authentication layer** — Add API key or JWT middleware for all non-health endpoints. The zero-auth posture is the single biggest risk.
2. **Document missing endpoints** — Add the 31 undocumented endpoints to `API_ENDPOINT_INVENTORY.md`.
3. **Remove ghost endpoints** — Delete `DELETE /proposals/{id}` and `DELETE /hourly-goals/{id}` from documentation, or implement them.
4. **Pydantic migration** — Convert `request.json()` handlers to Pydantic request bodies for type safety and auto-docs.
5. **Rate limit reads** — Add rate limiting for expensive GET endpoints (KG traverse, analysis history).
6. **BFS query optimization** — Add result count caps and batch loading for KG traversal endpoints.
7. **Evict in-memory caches** — Add LRU/TTL eviction to `_completed` and `_swarm_completed` dicts.
8. **Encrypt secrets at rest** — The `litellm_api_key` column should use server-side encryption.
9. **Reduce error verbosity** — Don't expose `str(exc)` in production 500 responses.
10. **Test coverage** — 20+ endpoints in `agents_crud.py` and `models_crud.py` have zero test coverage.
