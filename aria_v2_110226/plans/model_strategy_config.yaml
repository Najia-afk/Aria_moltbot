# Model Strategy Configuration
# Token Optimization - Phase 1.1
# Created: 2026-02-09 12:30 UTC
# Purpose: Enforce aggressive free model usage to achieve 90% free tier target

model_strategy:
  version: "1.0"
  description: "Tiered model selection to minimize token costs while maintaining capability"
  
  # Target: 90% free model usage
  targets:
    free_model_usage: 90  # percentage
    daily_cost_usd: 0.40
    avg_session_tokens: 8000
  
  # Tiered model hierarchy (highest priority first)
  tiers:
    tier_1_local:
      name: "qwen3-mlx"
      provider: "local_mlx"
      priority: 1
      target_usage: 80  # Target 80% of tasks
      cost_per_1k_tokens: 0.00
      context_window: 32768
      strengths:
        - fast_inference
        - zero_cost
        - private
        - general_tasks
      fallback_conditions:
        - task_requires_vision
        - context_exceeds_32k
        - local_model_unavailable
    
    tier_2_free_general:
      name: "trinity-free"
      provider: "openrouter"
      priority: 2
      target_usage: 15
      cost_per_1k_tokens: 0.00
      context_window: 131072
      strengths:
        - large_context
        - creative_tasks
        - reasoning
      fallback_conditions:
        - api_rate_limited
        - requires_coding_specialist
    
    tier_3_free_coding:
      name: "qwen3-coder-free"
      provider: "openrouter"
      priority: 3
      target_usage: 4
      cost_per_1k_tokens: 0.00
      context_window: 262144
      strengths:
        - code_generation
        - code_review
        - technical_analysis
      fallback_conditions:
        - api_rate_limited
        - task_requires_reasoning
    
    tier_4_paid_last_resort:
      name: "kimi"
      provider: "moonshot"
      priority: 4
      target_usage: 1  # Last resort only
      cost_per_1k_tokens: 0.015
      context_window: 262144
      strengths:
        - high_accuracy
        - complex_reasoning
        - fallback_reliability
      use_conditions:
        - all_free_models_failed
        - critical_task_requiring_reliability
        - explicit_user_override
  
  # Enforcement rules
  enforcement:
    # Before using paid model, try at least 2 free alternatives
    min_free_attempts: 2
    
    # Max consecutive paid model uses before forcing free tier
    max_consecutive_paid: 3
    
    # Daily budget enforcement
    daily_budget_usd: 0.40
    budget_exceeded_action: "force_free_only"
    
    # Session token limits per tier
    token_limits:
      qwen3-mlx: 32000
      trinity-free: 100000
      qwen3-coder-free: 200000
      kimi: 200000
  
  # Task-to-tier mapping (guidelines)
  task_mappings:
    simple_chat: tier_1_local
    code_review: tier_3_free_coding
    creative_writing: tier_2_free_general
    complex_analysis: tier_2_free_general
    security_critical: tier_4_paid_last_resort
    multi_step_reasoning: tier_2_free_general
    tool_invocation_heavy: tier_1_local
  
  # Monitoring
  metrics:
    track_usage_percentages: true
    log_model_selections: true
    alert_on_paid_threshold: 15  # Alert if >15% paid usage
    
# Implementation Status: CONFIGURATION COMPLETE
# Next Steps:
#   1. Integrate with session spawn logic
#   2. Add usage tracking to database
#   3. Create monitoring dashboard
#   4. Test tier fallback scenarios
