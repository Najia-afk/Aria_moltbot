{
  "message_id": "cc5c8a7b-f158-4af7-b55e-5117f91fb913",
  "session_id": "c1b8513e-43b9-4a18-985b-c27248266c8b",
  "content": "\u26a1\ufe0f **Sprint Planning Complete** \u2014 Here's the 3-sprint roadmap to ship the RPG Dashboard and Aria's self-improvement layer.\n\n---\n\n# SPRINT 1: \"The Crystal Ball\"\n**Theme:** Deploy Shiva's RPG Dashboard with static file serving and campaign visibility\n**Duration:** 1 day (Claude + Aria pair programming)\n**Target Date:** 2026-02-23\n\n## Tickets\n\n### TICKET-001: Static File Serving Infrastructure\n- **Type:** FEAT\n- **Priority:** P0\n- **Estimated LOC:** 45 lines\n- **Files:**\n  - `src/api/main.py` (+15 lines): Add `StaticFiles` mount for `/rpg`\n  - `src/api/static/` (new dir)\n  - `src/api/static/rpg/` (new dir)\n  - `docker-compose.yml` (+10 lines): Ensure bind-mount includes static/\n  - `.dockerignore` (+5 lines): Exclude static from build context for speed\n  - `aria_skills/health/skill.json` (+15 lines): Add static file health check\n- **Acceptance Criteria:**\n  - [ ] `GET http://localhost:8000/rpg/index.html` returns 200 with correct MIME type\n  - [ ] Directory listing disabled (security)\n  - [ ] Health check endpoint reports static file accessibility\n- **Dependencies:** None\n\n### TICKET-002: RPG Dashboard Single-File Application\n- **Type:** FEAT  \n- **Priority:** P0\n- **Estimated LOC:** 850 lines\n- **Files:**\n  - `src/api/static/rpg/index.html` (new, 850 lines): Self-contained HTML with embedded CSS (Tailwind-like utility classes) and vanilla JS\n  - Uses CDN: `vis-network` (KG visualization), `marked` (markdown rendering)\n- **Acceptance Criteria:**\n  - [ ] Dashboard loads without external build step (single HTML file)\n  - [ ] Campaign selector dropdown populated from `/api/rpg/campaigns`\n  - [ ] KG visualization renders entities (Party, NPC, Location, Quest) with color-coded nodes\n  - [ ] Character sheet modal displays stats on node click\n  - [ ] Session transcript viewer with collapsible message threads\n  - [ ] \"Resume Session\" button visible for active campaigns\n- **Dependencies:** TICKET-001, TICKET-003\n\n### TICKET-003: RPG Dashboard API Endpoints\n- **Type:** FEAT\n- **Priority:** P0  \n- **Estimated LOC:** 140 lines\n- **Files:**\n  - `src/api/routers/rpg.py` (new, 110 lines): FastAPI router with 4 endpoints\n  - `src/api/main.py` (+10 lines): `app.include_router(rpg_router, prefix=\"/api/rpg\")`\n  - `src/models/rpg.py` (+20 lines): Pydantic schemas `CampaignSummary`, `CampaignDetail`, `TranscriptResponse`\n- **Functions:**\n  - `GET /api/rpg/campaigns` \u2192 `list_campaigns()`\n  - `GET /api/rpg/campaign/{campaign_id}` \u2192 `get_campaign_detail(campaign_id: UUID)`\n  - `GET /api/rpg/session/{session_id}/transcript` \u2192 `get_session_transcript(session_id: UUID)`\n  - `GET /api/rpg/campaign/{campaign_id}/kg` \u2192 `get_campaign_kg(campaign_id: UUID)` (traversal query)\n- **Acceptance Criteria:**\n  - [ ] All endpoints return valid JSON with proper HTTP status codes\n  - [ ] KG endpoint returns nodes/edges format compatible with vis-network\n  - [ ] 404 returned for invalid UUIDs\n  - [ ] Response time < 200ms for campaigns with < 50 entities\n- **Dependencies:** TICKET-004\n\n### TICKET-004: RPG Skill Dashboard Queries\n- **Type:** FEAT\n- **Priority:** P0\n- **Estimated LOC:** 95 lines\n- **Files:**\n  - `aria_skills/rpg_campaign/skill.json` (+40 lines): Add 3 new tool definitions\n  - `aria_skills/rpg_campaign/__init__.py` (+55 lines): Implement `list_campaigns()`, `get_campaign_detail()`, `get_session_transcript()`\n- **Functions:**\n  - `list_campaigns(self, status: Optional[str] = None) -> List[Dict]`\n  - `get_campaign_detail(self, campaign_id: str) -> Dict` (includes party, npcs, locations, active_scene)\n  - `get_session_transcript(self, session_id: str, limit: int = 100) -> List[Dict]`\n- **Acceptance Criteria:**\n  - [ ] `api_client` can invoke all 3 methods\n  - [ ] Returns data in format expected by TICKET-003 schemas\n  - [ ] Uses existing database functions (no N+1 queries)\n- **Dependencies:** None\n\n## Definition of Done\n- [ ] Dashboard accessible at `/rpg/` with all 5 views functional (overview, KG viz, character sheets, transcript, resume)\n- [ ] API endpoints tested with curl and return < 200ms\n- [ ] Static files survive `docker-compose down && docker-compose up` (bind-mount verified)\n- [ ] No console errors in browser dev tools\n- [ ] Code reviewed by Shiva\n\n## Risk Assessment\n| Risk | Probability | Impact | Mitigation |\n|------|------------|--------|------------|\n| Static files not persisting in container | Low | High | Verify bind-mount in docker-compose, add health check |\n| vis-network CDN unavailable | Low | Medium | Embed minified vis-network.js locally if needed |\n| KG query performance on large campaigns | Medium | Medium | Add pagination (limit/offset) to endpoints |\n\n## Test Plan\n```bash\n# 1. Verify static serving\ncurl -s http://localhost:8000/rpg/index.html | head -20\n\n# 2. Test API endpoints\ncurl http://localhost:8000/api/rpg/campaigns | jq '.'\ncurl http://localhost:8000/api/rpg/campaign/{campaign_id} | jq '.entities | length'\n\n# 3. Dashboard E2E (manual)\n# Open browser to /rpg/, verify campaign loads, click KG node, check modal opens\n```\n\n---\n\n# SPRINT 2: \"Self-Healing Systems\"\n**Theme:** Skill validation, error enrichment, and resilient working memory\n**Duration:** 1 day\n**Target Date:** 2026-02-24\n\n## Tickets\n\n### TICKET-005: Skill Self-Validation Engine\n- **Type:** FEAT\n- **Priority:** P0\n- **Estimated LOC:** 180 lines\n- **Files:**\n  - `aria_skills/validator.py` (new, 120 lines): `SkillValidator` class\n  - `aria_skills/base.py` (+30 lines): Add `validate()` method to `BaseSkill`\n  - `aria_skills/catalog.py` (+30 lines): Add `validate_all_skills()` function\n- **Functions:**\n  - `validate_signature(skill_path: Path) -> ValidationReport`\n  - Checks: tool name uniqueness, param count match, required fields present, type annotations valid\n  - `ValidationReport` dataclass with `is_valid`, `errors[]`, `warnings[]`\n- **Acceptance Criteria:**\n  - [ ] Detects mismatch between `skill.json` tool count and `__init__.py` methods\n  - [ ] Reports missing docstrings as warnings\n  - [ ] Catches parameter name mismatches (e.g., `campaign_id` vs `campaignId`)\n  - [ ] Returns actionable error messages: \"Tool 'create_campaign' missing parameter 'title' in skill.json\"\n- **Dependencies:** None\n\n### TICKET-006: Error Context Enrichment Middleware\n- **Type:** FEAT\n- **Priority:** P0\n- **Estimated LOC:** 130 lines\n- **Files:**\n  - `src/api/middleware/error_enrichment.py` (new, 90 lines): FastAPI middleware\n  - `src/api/main.py` (+20 lines): `app.add_middleware(ErrorEnrichmentMiddleware)`\n  - `src/models/errors.py` (+20 lines): `EnrichedHTTPException` with `suggestion` field\n- **Functions:**\n  - `parse_422_validation_error(exc) -> str` (suggests fix based on pydantic error)\n  - `generate_recovery_hint(status_code, detail) -> str`\n  - Middleware adds `X-Error-Trace-ID` header and `suggestion` field to response body\n- **Acceptance Criteria:**\n  - [ ] 422 validation errors include field-specific suggestions: \"Missing required field 'title'. Add 'title' to request body.\"\n  - [ ] 500 errors include trace_id and generic recovery hint: \"Check logs for trace_id: abc-123\"\n  - [ ] SQL integrity errors parsed to suggest \"Check if referenced entity exists\"\n- **Dependencies:** None\n\n### TICKET-007: Working Memory Auto-Flush & Conflict Detection\n- **Type:** FEAT\n- **Priority:** P0\n- **Estimated LOC:** 110 lines\n- **Files:**\n  - `aria_skills/working_memory/__init__.py` (+60 lines): Add `_error_hook()`, `detect_conflicts()`, `force_sync()`\n  - `aria_mind/error_handler.py` (new, 50 lines): Global exception handler that triggers WM sync\n- **Functions:**\n  - `on_error(exception: Exception) -> None`: Syncs WM to disk before process exits\n  - `detect_conflicts() -> List[Conflict]`: Compares memory timestamps with file timestamps\n  - `Conflict` dataclass with `key`, `memory_value`, `file_value`, `resolution_strategy`\n- **Acceptance Criteria:**\n  - [ ] Unhandled exception triggers WM sync within 100ms\n  - [ ] On startup, if conflicts detected, log warning with diff summary\n  - [ ] Conflict resolution strategy: \"memory wins\" for < 1min diffs, \"file wins\" for > 1min\n  - [ ] Test: kill -9 process, verify context.json is consistent\n- **Dependencies:** None\n\n### TICKET-008: Validation CLI & Pre-Flight Checks\n- **Type:** CHORE\n- **Priority:** P1\n- **Estimated LOC:** 55 lines\n- **Files:**\n  - `skills/run_skill.py` (+55 lines): Add `--validate` and `--validate-all` flags\n- **Functions:**\n  - `main()`: argparse additions for validation mode\n  - `validate_skill(skill_name) -> int` (exit code 0 on success, 1 on failure)\n  - `validate_all() -> int` (exit code 0 if all pass, 1 if any fail)\n- **Acceptance Criteria:**\n  - [ ] `python skills/run_skill.py --validate rpg_campaign` returns exit code 0 if valid\n  - [ ] `python skills/run_skill.py --validate-all` checks all skills, prints summary table\n  - [ ] CI integration: `make validate` runs `--validate-all`\n- **Dependencies:** TICKET-005\n\n### TICKET-009: Error Enrichment Integration with Skills\n- **Type:** FIX\n- **Priority:** P1\n- **Estimated LOC:** 40 lines\n- **Files:**\n  - `aria_skills/api_client/__init__.py` (+40 lines): Catch HTTP 422 and append server suggestion to error message\n- **Functions:**\n  - `_handle_response()`: Extracts `suggestion` field from error JSON and includes in raised exception\n- **Acceptance Criteria:**\n  - [ ] When skill receives 422, error message includes server's actionable suggestion\n  - [ ] Skill error logs show both original error and suggested fix\n- **Dependencies:** TICKET-006\n\n## Definition of Done\n- [ ] `python skills/run_skill.py --validate-all` passes for all existing skills\n- [ ] Inducing a 422 returns helpful suggestion in error response",
  "thinking": "This is a comprehensive sprint planning request from Shiva (via Claude). Let me break down what I need to produce:\n\n1. **3 sprints** with specific constraints:\n   - Sprint 1: RPG HTML dashboard (Shiva's priority)\n   - Sprint 2: Self-improvement items (validation, error enrichment, WM sync)\n   - Sprint 3: RPG campaign memory in KG + session resume + polish\n\n2. **Each sprint needs**:\n   - Sprint Name and Theme (1 line)\n   - Duration (realistic - 1 day each)\n   - Tickets with specific format (TICKET-XXX, Title, Type, Priority, LOC, Files, AC, Dependencies)\n   - Definition of Done\n   - Risk Assessment\n   - Test plan\n\n3. **Technical constraints**:\n   - 5-layer architecture: DB -> ORM -> FastAPI -> api_client -> Skills -> ARIA\n   - Single self-contained HTML file with embedded CSS/JS for dashboard\n   - Real file paths, function names, line estimates\n   - Follow existing sprint format\n\nLet me plan each sprint in detail.\n\n## Sprint 1: RPG Dashboard Foundation\n\nTheme: Deliver Shiva's must-have RPG dashboard with static file serving infrastructure\n\nTickets:\n1. **TICKET-001**: Add static file serving to FastAPI\n   - Type: FEAT\n   - Priority: P0\n   - LOC: ~40 lines\n   - Files: src/api/main.py (add StaticFiles mount), src/api/static/ (new dir), src/api/static/rpg/ (new dir)\n   - AC: GET /rpg/index.html serves dashboard, directory created in container\n   \n2. **TICKET-002**: Create RPG Dashboard HTML (single self-contained file)\n   - Type: FEAT\n   - Priority: P0\n   - LOC: ~800 lines (HTML/CSS/JS)\n   - Files: src/api/static/rpg/index.html\n   - AC: Dashboard displays campaign selector, KG visualization with vis-network or D3, character sheets in modals, session history viewer, resume button\n   - Dependencies: TICKET-001\n\n3. **TICKET-003**: Add dashboard data API endpoints\n   - Type: FEAT\n   - Priority: P0\n   - LOC: ~120 lines\n   - Files: src/api/routers/rpg.py (new), src/api/main.py (include router)\n   - AC: GET /api/rpg/campaigns lists all, GET /api/rpg/campaign/{id} returns full campaign data with entities, GET /api/rpg/session/{id}/transcript returns messages\n   \n4. **TICKET-004**: Add rpg_campaign skill methods for dashboard queries\n   - Type: FEAT\n   - Priority: P1\n   - LOC: ~80 lines\n   - Files: aria_skills/rpg_campaign/skill.json (add 3 tools), aria_skills/rpg_campaign/__init__.py (add methods)\n   - AC: list_campaigns(), get_campaign_details(), get_session_transcript() work via api_client\n   - Dependencies: TICKET-003\n\n## Sprint 2: Self-Improvement Infrastructure\n\nTheme: Skill validation, error enrichment, and working memory resilience\n\nTickets:\n1. **TICKET-005**: Skill self-validation system (signature checking)\n   - Type: FEAT\n   - Priority: P0\n   - LOC: ~150 lines\n   - Files: aria_skills/base.py (add validate_skill() method), aria_skills/validator.py (new), aria_skills/catalog.py (integration)\n   - AC: validator.check_signature(skill_name) returns match/mismatch report, catches arity/type mismatches before execution\n   \n2. **TICKET-006**: Error context enrichment middleware\n   - Type: FEAT\n   - Priority: P0\n   - LOC: ~100 lines\n   - Files: src/api/middleware/error_enrichment.py (new), src/api/main.py (add middleware)\n   - AC: 422s include \"suggestion\" field with actionable fix, 500s include trace_id and recovery_hint\n   \n3. **TICKET-007**: Working Memory auto-flush on errors\n   - Type: FEAT\n   - Priority: P0\n   - LOC: ~60 lines\n   - Files: aria_skills/working_memory/__init__.py (add error_hook), aria_mind/error_handler.py (new, integrates with WM)\n   - AC: On unhandled exception, WM auto-syncs to file, conflict detection warns if disk newer than memory\n   \n4. **TICKET-008**: Add validation CLI command\n   - Type: CHORE\n   - Priority: P1\n   - LOC: ~40 lines\n   - Files: skills/run_skill.py (add --validate flag)\n   - AC: python skills/run_skill.py --validate checks all skill signatures against manifests\n   - Dependencies: TICKET-005\n\n## Sprint 3: RPG Memory & Session Persistence\n\nTheme: Campaign KG entities, auto-relations, and full session resume capability\n\nTickets:\n1. **TICKET-009**: RPG Campaign KG entity types\n   - Type: FEAT\n   - Priority: P0\n   - LOC: ~100 lines\n   - Files: aria_skills/rpg_campaign/__init__.py (add campaign_to_kg(), scene_to_kg()), aria_skills/knowledge_graph/ (add entity types to allowed list)\n   - AC: create_campaign auto-creates Campaign entity in KG, start_scene creates Scene entity with part_of Campaign relation\n   \n2. **TICKET-010**: Session state checkpointing (auto-save)\n   - Type: FEAT\n   - Priority: P0\n   - LOC: ~120 lines\n   - Files: aria_skills/rpg_campaign/__init__.py (add checkpoint_session(), load_checkpoint()), aria_memories/rpg_checkpoints/ (new dir)\n   - AC: Every 5 messages auto-saves checkpoint, resume from checkpoint loads full session state\n   \n3. **TICKET-011**: Bulk operation pipeline for KG\n   - Type: FEAT\n   - Priority: P1\n   - LOC: ~140 lines\n   - Files: aria_skills/pipeline_skill/pipelines/bulk_kg.yaml (new), aria_skills/knowledge_graph/ (add batch methods)\n   - AC: Pipeline accepts list of entities/relations, dry-run mode previews changes, executes in transaction\n   \n4. **TICKET-012**: Git-integrated change tracking\n   - Type: FEAT\n   - Priority: P2\n   - LOC: ~80 lines\n   - Files: aria_skills/ci_cd/__init__.py (add suggest_commit_message()), src/api/routers/git.py (new endpoint)\n   - AC: analyzes git diff and generates conventional commit message suggestion\n   \n5. **TICKET-013**: RPG Dashboard v2 (integration)\n   - Type: FEAT\n   - Priority: P1\n   - LOC: ~200 lines\n   - Files: src/api/static/rpg/index.html (enhancements)\n   - AC: Resume button loads checkpoint, KG auto-refresh shows Campaign/Scene entities, transcript searchable\n   - Dependencies: TICKET-009, TICKET-010, TICKET-002\n\nLet me refine these with exact file paths, function signatures, and line counts. I'll write them as formal sprint artifacts.",
  "tool_calls": null,
  "tool_results": null,
  "model": "kimi",
  "input_tokens": 21571,
  "output_tokens": 4096,
  "total_tokens": 25667,
  "cost_usd": 0.0152466,
  "latency_ms": 76068,
  "finish_reason": "length"
}