# S-110: Delete Superseded llm/ Skill Directory
**Epic:** E5 — Architecture Cleanup | **Priority:** P1 | **Points:** 1 | **Phase:** 2

## Problem
`aria_skills/llm/` contains `MoonshotSkill` (registered as "llm") and `OllamaSkill` (registered as "ollama"). Both are duplicated by `aria_skills/moonshot/` and `aria_skills/ollama/` directories, causing double-registration.

## Fix
1. Delete `aria_skills/llm/` directory
2. Verify `moonshot/` and `ollama/` skills still register correctly
3. Remove any imports of `llm` skill in other files

## Verification
```bash
# Directory should not exist
test -d aria_skills/llm && echo "FAIL: still exists" || echo "OK: deleted"
# EXPECTED: OK: deleted

# No references remain
grep -rn "from aria_skills.llm" aria_skills/ aria_engine/ aria_agents/
# EXPECTED: no matches

pytest tests/ -v
# EXPECTED: all pass
```

---

# S-111: Delete Deprecated database/ Skill Directory
**Epic:** E5 — Architecture Cleanup | **Priority:** P1 | **Points:** 1 | **Phase:** 2

## Problem
`aria_skills/database/` is marked deprecated but still registered in the skill registry.

## Fix
1. Delete `aria_skills/database/` directory
2. Remove any imports or references
3. Ensure `api_client` skill handles all DB-proxy operations

## Verification
```bash
test -d aria_skills/database && echo "FAIL" || echo "OK: deleted"
# EXPECTED: OK: deleted

grep -rn "from aria_skills.database" aria_skills/ aria_engine/ aria_agents/
# EXPECTED: no matches
```

---

# S-113: Refactor 11 Skills to Use api_client Public Methods
**Epic:** E5 — Architecture Cleanup | **Priority:** P1 | **Points:** 5 | **Phase:** 2

## Problem
11 skills access `self._api._client` directly instead of public methods.

## Fix
After S-112 creates public methods, refactor each skill:
```python
# BEFORE
result = await self._api._client.get("/goals")
# AFTER
result = await self._api.list_goals()
```

Skills to refactor: agent_manager, goals, hourly_goals, knowledge_graph, performance, schedule, sprint_manager, working_memory, moltbook

## Dependencies
- S-112 must complete first

## Verification
```bash
grep -rn "\._client\." aria_skills/ | grep -v "api_client/" | grep -v "__pycache__"
# EXPECTED: no matches (only api_client itself uses _client)
```

---

# S-115: Fix conversation_summary Architecture Violation
**Epic:** E5 — Architecture Cleanup | **Priority:** P1 | **Points:** 3 | **Phase:** 2

## Problem
`aria_skills/conversation_summary/__init__.py` makes direct httpx calls to LiteLLM instead of using the litellm skill or api_client.

## Fix
Route LLM calls through the litellm skill:
```python
# BEFORE
async with httpx.AsyncClient() as client:
    response = await client.post("http://litellm:18793/v1/chat/completions", ...)

# AFTER
from aria_skills.litellm import LiteLLMSkill
litellm = LiteLLMSkill()
result = await litellm.chat_completion(messages=messages, model=model)
```

## Dependencies
- S-106 (remove hardcoded key) should be done together

## Verification
```bash
grep -n "httpx" aria_skills/conversation_summary/__init__.py
# EXPECTED: no httpx imports
```

---

# S-116: Fix input_guard, social, session_manager Architecture
**Epic:** E5 — Architecture Cleanup | **Priority:** P1 | **Points:** 5 | **Phase:** 2

## Problem
- `input_guard` (L0): Creates independent httpx.AsyncClient for security event logging
- `social` (L3): Creates fallback httpx.AsyncClient instances to multiple URLs
- `session_manager` (L2): Direct filesystem reads + independent httpx.AsyncClient

## Fix
Route all external calls through api_client. If filesystem access is required for performance, document as explicit exception.

## Verification
```bash
grep -rn "httpx.AsyncClient" aria_skills/ | grep -v "api_client/" | grep -v "__pycache__"
# EXPECTED: no matches (only api_client creates httpx clients)
```
